<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Checkout - {{shop}}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://zenobiapay.com/zenobia-pay-modal.js"></script>
</head>

<body class="min-h-screen bg-gray-100">
  <header class="w-full bg-white border-b border-gray-200 py-4 px-6 flex items-center justify-between">
    <span id="shop-name" class="text-lg font-semibold text-gray-900"></span>
  </header>
  <div class="min-h-screen flex flex-col md:flex-row">
    <div
      class="w-full md:w-2/5 bg-white flex flex-col justify-center items-center p-8 border-r border-gray-200 min-h-[400px]">
      <div class="h-4 bg-gray-200 rounded w-2/3 mb-2 animate-pulse"></div>
      <div class="h-4 bg-gray-200 rounded w-1/2 mb-2 animate-pulse"></div>
      <div class="h-4 bg-gray-200 rounded w-1/3 mb-6 animate-pulse"></div>
      <div class="h-4 bg-gray-200 rounded w-1/2 mb-2 animate-pulse"></div>
      <div class="h-4 bg-gray-200 rounded w-2/3 mb-6 animate-pulse"></div>
    </div>
    <div class="w-full md:w-3/5 flex items-center justify-center relative bg-gray-50 min-h-[400px]">
      <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none select-none z-0">
        <div class="w-full max-w-md p-8 space-y-6">
          <div class="h-6 bg-gray-200 rounded w-1/2 mb-4 animate-pulse"></div>
          <div class="h-4 bg-gray-200 rounded w-1/3 mb-6 animate-pulse"></div>
          <div class="h-16 bg-gray-200 rounded mb-4 animate-pulse"></div>
          <div class="h-10 bg-gray-200 rounded mb-4 animate-pulse"></div>
          <div class="h-10 bg-gray-200 rounded mb-4 animate-pulse"></div>
          <div class="h-6 bg-gray-200 rounded w-1/4 mb-2 animate-pulse"></div>
          <div class="h-8 bg-gray-200 rounded w-1/2 animate-pulse"></div>
        </div>
      </div>
      <div id="zenobia-modal-root" class="w-full z-10"></div>
    </div>
  </div>
  <script>
    const session = JSON.parse('{{session}}');
    const transferRequestId = "{{transferRequestId}}";
    // Amount in cents, injected from backend
    const amount = Number("{{amountCents}}");
    // Transfer signature for status listening
    const transferSignature = "{{transferSignature}}";
    // Pass test and cancelUrl for future use or debugging
    const isTest = session.test;
    const cancelUrl = session.cancelUrl;

    console.log("session", session);

    // Format shop name: remove .myshopify.com, replace - with spaces, capitalize words
    function formatShopName(shop) {
      return shop
        .replace(/\.myshopify\.com$/, '')
        .replace(/-/g, ' ')
        .replace(/\b\w/g, c => c.toUpperCase());
    }
    const formattedShopName = formatShopName(session.shop);
    document.getElementById('shop-name').textContent = formattedShopName;

    // Delay modal init for loading effect
    ZenobiaPayModal.init({
      isOpen: true,
      onClose: () => { window.location.href = session.cancelUrl; },
      transferRequestId,
      signature: transferSignature,
      amount, // amount in cents
      target: '#zenobia-modal-root',
      onSuccess: () => {
        console.log("Woohoo")
        window.location.href = session.returnUrl;
      },
      onError: (error) => { alert(error.message); },
      onStatusChange: (status) => { console.log('Payment status:', status); },
      isTest: isTest,
    });
  </script>
</body>

</html>